<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI 뉴스 대시보드 by 믿음</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-datatables@9.0.3/dist/style.css">
  <style>
    :root{
      --bg:#0b0f14;           /* 다크 기본값 */
      --card:#0f1520;
      --text:#e6edf3;
      --muted:#9fb0c3;
      --border:#1f2a37;
      --brand:#3b82f6;
      --brand-weak:#1d4ed8;
      --chip:#111827;
      --chip-text:#d1d5db;
      --shadow:0 10px 30px rgba(0,0,0,.45);
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f6f7fb;
        --card:#ffffff;
        --text:#0b1220;
        --muted:#667085;
        --border:#e5e7eb;
        --brand:#2563eb;
        --brand-weak:#1e40af;
        --chip:#f2f4f7;
        --chip-text:#374151;
        --shadow:0 10px 30px rgba(0,0,0,.06);
      }
    }

    /* 레이아웃 */
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    }
    .wrap{
      max-width:1100px; margin:0 auto; padding:24px;
    }

    /* 헤더 카드 */
    header{
      background:var(--card); border:1px solid var(--border);
      border-radius:20px; padding:20px 20px 12px; box-shadow:var(--shadow);
      position:sticky; top:0; z-index:20; backdrop-filter:saturate(180%) blur(8px);
    }
    h1{
      font-size:22px; margin:0 0 6px 0; letter-spacing:.1px;
      display:flex; align-items:center; gap:10px;
    }
    h1::before{
      content:""; width:9px; height:22px; border-radius:3px; background:linear-gradient(180deg,var(--brand),var(--brand-weak));
      display:inline-block;
    }
    .muted{ color:var(--muted); font-size:13px; }

    /* 툴바 */
    .toolbar{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:12px; }
    .input, .select{
      background:#0000; border:1px solid var(--border); color:var(--text);
      padding:10px 12px; border-radius:12px; outline:none; transition:.18s border-color, .18s box-shadow;
    }
    .input:focus, .select:focus{ border-color:var(--brand); box-shadow:0 0 0 3px color-mix(in srgb, var(--brand) 25%, transparent); }
    .input{ min-width:260px; }
    .select{ min-width:180px; }
    .badge{
      padding:6px 10px; background:var(--chip); color:var(--chip-text);
      border:1px solid var(--border); border-radius:999px; font-size:12px;
    }

    /* 테이블 카드 */
    .card{
      margin-top:18px; background:var(--card); border:1px solid var(--border);
      border-radius:20px; padding:14px; box-shadow:var(--shadow);
      overflow:hidden;
    }
    /* simple-datatables 기본 리셋 & 커스텀 */
    table.dataTable-table{
      width:100%; border-collapse:separate; border-spacing:0;
      font-size:14px;
    }
    .dataTable-top, .dataTable-bottom{ display:none !important; } /* 내 검색/필터만 쓰므로 숨김 */
    table.dataTable-table thead th{
      position:sticky; top:0; z-index:1;
      background:linear-gradient(180deg, color-mix(in srgb, var(--card) 90%, #fff 10%), var(--card));
      color:var(--muted);
      text-align:left; font-weight:600; font-size:12px; letter-spacing:.2px;
      border-bottom:1px solid var(--border); padding:12px;
    }
    table.dataTable-table tbody td{
      border-bottom:1px solid var(--border); padding:12px; vertical-align:top;
    }
    table.dataTable-table tbody tr:nth-child(odd){ background:color-mix(in srgb, var(--card) 95%, #000 5%); }
    table.dataTable-table tbody tr:hover{ background:color-mix(in srgb, var(--card) 85%, var(--brand) 15% / 8%); }

    /* 링크 */
    a{ color:var(--brand); text-decoration:none; }
    a:hover{ text-decoration:underline; }

    /* 빈 상태 / 로딩 */
    .empty, .loading{
      padding:24px; color:var(--muted); text-align:center;
    }

    /* 반응형 */
    @media (max-width:760px){
      .input{ min-width:unset; flex:1; }
      table.dataTable-table thead th:nth-child(3),
      table.dataTable-table tbody td:nth-child(3){ display:none; } /* 모바일에서 요약 컬럼 숨김 */
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>AI 뉴스 대시보드</h1>
      <div class="muted">Asia/Seoul 기준 최신순 • Google News RSS 기반</div>
      <div class="toolbar">
        <input id="search" class="input" placeholder="검색(제목/요약/매체/키워드)">
        <select id="queryFilter" class="select">
          <option value="">모든 키워드</option>
        </select>
        <span class="badge" id="countBadge">0건</span>
      </div>
    </header>

    <div class="card">
      <div id="state" class="loading">불러오는 중…</div>
      <table id="newsTable" style="display:none;"></table>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/simple-datatables@9.0.3"></script>
  <script>
    const src = "data/google_news_latest.json";

    fetch(src, {cache: "no-store"})
      .then(r => {
        if(!r.ok) throw new Error("데이터 로드 실패");
        return r.json();
      })
      .then(rows => {
        const state = document.getElementById("state");
        const tableEl = document.getElementById("newsTable");
        if(!Array.isArray(rows) || rows.length === 0){
          state.className = "empty";
          state.textContent = "데이터가 없습니다. JSON을 업데이트하세요.";
          return;
        }

        rows.forEach(r => r.published_iso = r.published_kst || "");
        const qSet = [...new Set(rows.map(r => r.query).filter(Boolean))].sort();
        const qSel = document.getElementById("queryFilter");
        qSet.forEach(q => {
          const opt = document.createElement("option");
          opt.value = q; opt.textContent = q;
          qSel.appendChild(opt);
        });

        const table = new simpleDatatables.DataTable("#newsTable", {
          searchable: true, fixedHeight: false, perPage: 25,
          data: {
            headings: ["키워드","제목","요약","매체","발행(KST)"],
            data: rows.map(r => ([
              esc(r.query || ""),
              `<a href="${r.link}" target="_blank" rel="noopener">${esc(r.title || "")}</a>`,
              esc(r.summary_1line || ""),
              esc(r.source || ""),
              esc(r.published_kst || "")
            ]))
          }
        });

        // 상태 영역 토글
        state.style.display = "none";
        tableEl.style.display = "table";

        // 검색/필터/카운트
        const search = document.getElementById("search");
        const countBadge = document.getElementById("countBadge");
        search.addEventListener("input", e => table.search(e.target.value));
        qSel.addEventListener("change", () => {
          table.columns().search(qSel.value ? [[0, qSel.value]] : []);
          updateCount();
        });

        function updateCount(){ countBadge.textContent = `${table.data.length}건`; }
        updateCount();
        table.on("datatable.search", updateCount);
        table.on("datatable.page", updateCount);
        table.on("datatable.perpage", updateCount);
      })
      .catch(err => {
        const state = document.getElementById("state");
        state.className = "empty";
        state.textContent = "데이터를 불러오지 못했습니다. 파일 경로/권한을 확인하세요.";
        console.error(err);
      });

    function esc(s){return (s||"").replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"}[m]))}
  </script>
</body>
</html>
